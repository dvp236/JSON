<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>IAB Javascript SDK - Login Callback</title>
</head>
<body>
<h1>Login Callback - IAB Javascript SDK</h1>

<div id="results">
</div>

<script type="text/javascript">

(function(){
    
    function decodeHash(){
		var result = {}, i,p;
		var loc = location;
		var hash = loc.hash,
			parts;
		
		if(hash){
		    hash = hash.substr(0);
		    parts = hash.split('&');
		}
		for(i=0;i<parts.length;i++){
		    p = parts[i].split('=');
		    if(p.length >=2){
				result[p[0]] = p[1];
		    }
		    else{
				result[p]='';
		    }
		}
		return result;
    }
    
    function extractJwtToken(){
		var parts = decodeHash();
		var cb_ACCESS_KEY = 'cb-IAB-JWT'
		var token = parts['access_token'];
		window.localStorage.setItem(cb_ACCESS_KEY, token);
		
		var parent = window.opener;
		var iab = parent.IAB;
		iab.setAccessToken(token);
		setTimeout(function(){
		    window.close();
		}, 100);
    }
    /*
    #token_type=Bearer&expires_in=999&nonce=b221e968-cde2-421a-8580-97adf59f73a5&access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE0NjMwOTgwODMxODQsInN1YiI6ImNhbm9uaWNhbEB2IiwiaXNzIjoiSUFCIiwidXNlciI6eyJpZCI6NTA4LCJmaXJzdG5hbWUiOiJGcmVkIiwibGFzdG5hbWUiOiJTbWl0aCIsImVtYWlsIjoiY2Fub25pY2FsQHYiLCJ1c2VybmFtZSI6ImNhbm9uaWNhbEB2Iiwic3NvSWQiOiI1NDE5ZjQzNC04MGJhLTQzZWYtYWY2Yy1lMDhlOGJlYTZkYmIiLCJwYXNzd29yZEhhc2giOiIkMmEkMTAkemFueDJ5YzR1cXhxbXpqeVhpMHV1ZXB0d2dleENoVlJaOWxReWhxMTVSdVBLWGVkY0Q3LmEiLCJlbmFibGVkIjp0cnVlLCJjb21wYW55IjoiRm9vY28iLCJyZWdpc3RlclR5cGVJZCI6MSwibGVnYWN5UklkIjowLCJhY2Nlc3NLZXkiOiJjYW5vbmljYWxfSEFUX3ZYWEZvb2NvIiwiYWNjZXNzU2VjcmV0IjoidUlULU1pVUNTOHhqbVE0S1ptRUt3ZyIsImxhc3RMb2dpbiI6MTQ2MTI4MjU1NTAwMCwiZ3JlY2FwdGNoYVJlc3BvbnNlIjpudWxsfSwiaWF0IjoxNDYzMDkwODgzMTg0fQ.zwaMhqJT6Jn9ZLnSieaa3T2sJOkTYjYtnt4xQ2ih6ik
    */
    extractJwtToken();
    
})();

</script>


</body>
</html>
